# 🚀 Panda AI 因子库启动指南

## ❌ 常见错误

如果您看到以下错误：
- `ERR_CONNECTION_REFUSED`
- `Failed to load resource: net::ERR_CONNECTION_REFUSED`
- `localhost:8111/api/v_...` 无法连接

**原因**: 后端服务没有启动

---

## ✅ 解决方案（3步）

### Step 1: 打开终端

在项目目录打开 PowerShell 或命令提示符：

```powershell
cd c:\Users\Lenovo\Desktop\PandaQuantFlow\panda_factor-main\panda_factor-main
```

### Step 2: 启动后端服务

```powershell
py start_server_fixed.py
```

**您将看到**：
```
======================================================================
PandaFactor 服务启动（修复版）
======================================================================

[1/2] 检查依赖...
✅ 所有依赖已安装

[2/2] 启动服务...

服务地址:
  - 主页:     http://127.0.0.1:8111/
  - API文档:  http://127.0.0.1:8111/docs
  - 因子界面: http://127.0.0.1:8111/factor

按 Ctrl+C 停止服务
======================================================================

INFO:     Uvicorn running on http://0.0.0.0:8111 (Press CTRL+C to quit)
```

### Step 3: 访问因子界面

在浏览器中打开：

```
http://127.0.0.1:8111/factor/
```

或者访问 API 文档：

```
http://127.0.0.1:8111/docs
```

---

## 🔍 验证服务状态

在**另一个终端窗口**运行：

```powershell
py check_service.py
```

**正常输出**：
```
✅ 因子界面: 正常
   URL: http://127.0.0.1:8111/factor/

✅ API文档: 正常
   URL: http://127.0.0.1:8111/docs

✅ 主页: 正常
   URL: http://127.0.0.1:8111/
```

---

## ⚠️ 常见问题

### 问题1: 端口被占用

**错误信息**：
```
Error: [Errno 10048] error while attempting to bind on address ('0.0.0.0', 8111)
```

**解决方法**：

1. 查找占用端口的进程：
```powershell
netstat -ano | Select-String "8111"
```

2. 结束该进程（替换 `<PID>` 为实际进程ID）：
```powershell
taskkill /PID <PID> /F
```

3. 重新启动服务

### 问题2: 依赖缺失

**错误信息**：
```
ModuleNotFoundError: No module named 'fastapi'
```

**解决方法**：
```powershell
pip install fastapi uvicorn pydantic pymongo
```

### 问题3: MongoDB 连接失败

**错误信息**：
```
pymongo.errors.ServerSelectionTimeoutError
```

**解决方法**：

MongoDB 是可选的，服务可以在没有 MongoDB 的情况下运行。如果需要完整功能：

1. 安装 MongoDB Community Edition
2. 启动 MongoDB 服务：
```powershell
net start MongoDB
```

---

## 📝 重要提示

### ⚠️ 保持服务运行

- 启动服务后，**不要关闭终端窗口**
- 服务会一直运行，直到您按 `Ctrl+C` 停止
- 如果关闭了终端，需要重新运行 `py start_server_fixed.py`

### 🔄 每次使用前

每次想使用 Panda AI 因子库时：

1. 打开终端
2. 运行 `py start_server_fixed.py`
3. 等待服务启动（约5-10秒）
4. 在浏览器中访问 `http://127.0.0.1:8111/factor/`

### 🛑 停止服务

在运行服务的终端窗口中按 `Ctrl+C`

---

## 🎯 快速启动脚本

为了更方便，您可以双击运行：

```
一键修复并启动.bat
```

这个批处理文件会自动：
1. 检查依赖
2. 启动服务
3. 打开浏览器

---

## 📚 相关文档

- `START_HERE.md` - 完整项目介绍
- `QUICK_START.md` - 快速开始指南
- `SERVICE_SUCCESS_GUIDE.md` - 服务成功指南

---

## 🎉 成功标志

当您看到以下内容时，说明服务已成功启动：

```
INFO:     Uvicorn running on http://0.0.0.0:8111 (Press CTRL+C to quit)
INFO:     Started server process [xxxxx]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

现在可以在浏览器中访问因子界面了！

---

**最后更新**: 2026-01-14
